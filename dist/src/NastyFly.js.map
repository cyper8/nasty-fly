{"version":3,"file":"NastyFly.js","sourceRoot":"","sources":["../../src/NastyFly.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, css, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\n\n/**\n * LitElement based component depicting a fly which can sit somewhere\n * on the page, fly over the page buzzing, and be smashed\n *\n * The fly will try to escape when clicked\n * When clicked while flying it will die\n * Try to doubleclick on it realy fast\n *\n * @export\n * @class NastyFly\n * @extends {LitElement}\n */\nexport class NastyFly extends LitElement {\n  /**\n   * Basic component of the fly's speed\n   *\n   * @protected\n   * @static\n   * @type {number}\n   * @memberof NastyFly\n   */\n  protected static БАЗОВИЙ_КРОК: number = 20;\n\n  /**\n   * Distance at which fly 'sees' the edge of the page and turns away\n   *\n   * @protected\n   * @static\n   * @type {number}\n   * @memberof NastyFly\n   */\n  protected static БАЗОВИЙ_ПОРІГ: number = 95;\n\n  /**\n   * A state fly is currently in.\n   *\n   * @type {('сидить' | 'літає' | 'прибита')}\n   * @memberof NastyFly\n   */\n  @property({ type: String }) стан: 'сидить' | 'літає' | 'прибита' = 'сидить';\n\n  /**\n   * Liveliness of a fly - a period it can constantly be flying\n   * 0 - exactly 1 second\n   * n (up to 10) - random time from 1 to n/2 seconds.\n   * This also increases speed and reduces takeoff timeout.\n   *\n   * @type {number}\n   * @memberof NastyFly\n   */\n  @property({ type: Number })\n  set liveliness(val: number) {\n    let newval: number = val;\n    if (val > 10) {\n      newval = 10;\n    }\n    if (val < 0) {\n      newval = 0;\n    }\n    this.__liveliness = newval;\n  }\n\n  get liveliness(): number {\n    return this.__liveliness;\n  }\n\n  private __liveliness: number = 5;\n\n  /**\n   * An audio element to do buzzing\n   *\n   * @private\n   * @type {HTMLAudioElement}\n   * @memberof NastyFly\n   *\n   * @fires HTMLAudioElement#canplaythrough\n   * @fires NastyFly#readytofly when ready to play\n   */\n  @state() private __buzz: HTMLAudioElement = new Audio('../assets/buzz.mp3');\n\n  @state() private __x: number = 0;\n\n  @state() private __y: number = 0;\n\n  @state() private __кут: number = Math.random() * (Math.PI * 2);\n\n  @state() private __затримкаЗльоту: number | undefined;\n\n  @state() private __CANBUZZ: Boolean = false;\n\n  static get styles() {\n    return css`\n      .муха {\n        display: block;\n        position: absolute;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        touch-action: manipulation;\n        /* border: solid 1px; */\n        overflow: visible;\n        background-position: center;\n        background-repeat: no-repeat;\n        background-size: cover;\n        background-image: url('../assets/fly.svg');\n        transform-origin: 0px 0px;\n      }\n\n      .муха[is='літає'] {\n        background-image: url('../assets/fly-flies.svg');\n      }\n\n      .муха[is='прибита'] {\n        background-image: url('../assets/fly-flies.svg');\n        background-color: pink;\n      }\n    `;\n  }\n\n  /**\n   * Initiates a takeoff\n   *\n   * @protected\n   * @returns {Promise<void>} resolves when takeoff is over\n   * @memberof NastyFly\n   *\n   * Emits upon takeoff\n   *\n   * @fires HastyFly#літає\n   */\n  protected _зліт(): Promise<void> {\n    this.стан = 'літає';\n    if (this.__CANBUZZ) {\n      this.__buzz.play();\n    }\n    return new Promise<void>(resolve => {\n      this.__затримкаЗльоту = window.setTimeout(() => {\n        clearTimeout(this.__затримкаЗльоту);\n        /**\n         * An 'літає' event meaning the fly has taken off\n         *\n         * @event NastyFly#літає\n         * @type CustomEvent\n         */\n        this.dispatchEvent(\n          new CustomEvent<'літає'>('літає', { bubbles: true, composed: true })\n        );\n        resolve();\n      }, /* не менше, мс */ 100 + Math.random() * (90 - this.liveliness * 3) /* плюс не більше, мс */);\n    });\n  }\n\n  /**\n   * A method that requests a change of placement and orientation of a fly\n   * on the next animation frame\n   *\n   * @private\n   * @param {[number, number]} точка - new place to render the fly\n   * @returns {[number, number]} - the same point\n   * @memberof NastyFly\n   */\n  private __рухатисяДо(точка: [number, number]): [number, number] {\n    let муха: NastyFly = (this.shadowRoot as ShadowRoot).querySelector(\n      'div.муха'\n    ) as NastyFly;\n    const [x, y]: [number, number] = [муха.offsetLeft, муха.offsetTop];\n    const [X, Y]: [number, number] = точка;\n    const новийНапрям =\n      Math.atan((Y - y) / (X - x)) + ((X >= x ? 1 : -1) * Math.PI) / 2;\n    муха = this;\n    window.requestAnimationFrame(() => {\n      муха.__кут = новийНапрям;\n      муха.__x = X;\n      муха.__y = Y;\n    });\n    return точка;\n  }\n\n  /**\n   * Randomized spot ahead the fly to jump to on the next tick\n   *\n   * @readonly\n   * @private\n   * @type {[number, number]}\n   * @memberof NastyFly\n   */\n  private get __випадковеМісцеПопереду(): [number, number] {\n    const f: ['sin', 'cos'] = ['sin', 'cos'];\n    const випадковийКоефіцієнтНапряму = Math.random(); // що швидше рухається, то менше відхилення вбік\n    const випадковийКоефіцієнтШвидкості = 1 - випадковийКоефіцієнтНапряму;\n\n    function поправкаНаближенняДоКраю(\n      положення: number,\n      напрям: number,\n      поріг: number\n    ) {\n      const розміриПоля = [window.innerWidth, window.innerHeight];\n\n      // підлітає до краю (лівого або верхнього)\n      if (положення < поріг) {\n        return (поріг - положення) / поріг;\n      }\n\n      // підлітає до краю (правого або нижнього)\n      if (положення > розміриПоля[напрям] - поріг) {\n        return (розміриПоля[напрям] - поріг - положення) / поріг;\n      }\n      return 0;\n    }\n\n    const кут =\n      this.__кут + ((випадковийКоефіцієнтНапряму * Math.PI) / 4 - Math.PI / 8);\n    return [this.__x, this.__y].map((координата, напрям) => {\n      // напрям: горизонтальний - 0, вертикальний - 1\n      const зсув =\n        (NastyFly.БАЗОВИЙ_КРОК + this.liveliness * 3) *\n        (1 + Math.random() + випадковийКоефіцієнтШвидкості) *\n        ((напрям ? -1 : 1) * Math[f[напрям]](кут) +\n          поправкаНаближенняДоКраю(координата, напрям, NastyFly.БАЗОВИЙ_ПОРІГ));\n      return координата + зсув;\n    }) as [number, number];\n  }\n\n  /**\n   * A method to launch flying process for specified time\n   *\n   * @param {number} час - time to fly in seconds\n   * @returns {Promise<void>} resolves when flying is done\n   * @memberof NastyFly\n   */\n  літатиПротягом(час: number): Promise<void> {\n    const кінець = Date.now() + Math.round(час * 1000);\n    const муха = this;\n    let кроки: number;\n    return муха._зліт().then(\n      () =>\n        new Promise<void>(resolve => {\n          кроки = window.setInterval(() => {\n            if (Date.now() < кінець && муха.стан === 'літає') {\n              муха.__рухатисяДо(муха.__випадковеМісцеПопереду);\n            } else {\n              clearInterval(кроки);\n              if (муха.стан === 'літає') муха._сісти();\n              resolve();\n            }\n          }, 10);\n        })\n    );\n  }\n\n  /**\n   * Seats the fly down\n   *\n   * @protected\n   * @memberof NastyFly\n   *\n   * @fires NastyFly#сидить\n   */\n  protected _сісти() {\n    this.стан = 'сидить';\n    this.__buzz.pause();\n    /**\n     * An event indicating the fly is seated\n     *\n     * @event NastyFly#сидить\n     * @type CustomEvent\n     */\n    this.dispatchEvent(\n      new CustomEvent<'сидить'>('сидить', { bubbles: true, composed: true })\n    );\n  }\n\n  /**\n   * A command for the fly to die\n   *\n   * @memberof NastyFly\n   *\n   * @fires NastyFly#смерть\n   */\n  вмерти() {\n    this.стан = 'прибита';\n    this.__buzz.pause();\n    /**\n     * An event indicating the fly is dead\n     *\n     * @event NastyFly#смерть\n     * @type CustomEvent\n     */\n    this.dispatchEvent(\n      new CustomEvent<'смерть'>('смерть', { bubbles: true, composed: true })\n    );\n  }\n\n  /**\n   * Creates an instance of NastyFly.\n   * @memberof NastyFly\n   */\n  constructor() {\n    super();\n    this.__buzz.addEventListener('canplaythrough', () => {\n      this.__CANBUZZ = true;\n      /**\n       * An event indicating the fly is ready to fly\n       * Meaning - really, with buzzing and all ;)\n       *\n       * @event NastyFly#readytofly\n       * @type CustomEvent\n       */\n      this.dispatchEvent(\n        new CustomEvent('readytofly', { bubbles: false, composed: true })\n      );\n    });\n    this.__x = Math.round(Math.random() * window.innerWidth);\n    this.__y = Math.round(Math.random() * window.innerHeight);\n    /**\n     * The fly will try to escape when clicked\n     * When clicked while flying it will die\n     * Try to doubleclick realy fast\n     */\n    this.addEventListener('click', e => {\n      const муха = e.target as NastyFly;\n      if (!муха) return;\n      if (муха.стан === 'сидить') {\n        муха.літатиПротягом(\n          /* від */ 1 +\n            Math.random() *\n              /* до приблизно +*/ (this.liveliness / 2) /* секунд */\n        );\n      } else if (муха.стан === 'літає') {\n        муха.вмерти();\n      }\n    });\n  }\n\n  /**\n   * Renders the fly's appearance\n   *\n   * @returns {TemplateResult}\n   * @memberof NastyFly\n   */\n  render(): TemplateResult {\n    return html`\n      <div\n        class=\"муха\"\n        style=\"left: ${this.__x}px; top: ${this\n          .__y}px; transform: rotateZ(${this\n          .__кут}rad) translate(-50%,-50%) scale(1);\"\n        is=${this.стан}\n      ></div>\n    `;\n  }\n}\n"]}